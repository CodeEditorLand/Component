import{p}from"./Context.CevrpyGa.js";import{d as createSignal,m as onCleanup}from"./web.BwkxOWcj.js";var makeWS=(e,t,n=[])=>{const r=new WebSocket(e,t),a=r.send.bind(r);return r.send=e=>1==r.readyState?a(e):n.push(e),r.addEventListener("open",(()=>{for(;n.length;)a(n.shift())})),r},createWSState=e=>{const[t,n]=createSignal(e.readyState),r=e.close.bind(e);return e.addEventListener("open",(()=>n(1))),e.close=(...e)=>{r(...e),n(2)},e.addEventListener("close",(()=>n(3))),t},makeReconnectingWS=(e,t,n={})=>{let r,a=n.retries||1/0;const o=[];let s=[["close",()=>{a-- >0&&setTimeout(c,n.delay||3e3)}]];const c=()=>{r&&r.readyState<2&&r.close(),r=Object.assign(makeWS(e,t,o),{reconnect:c}),s.forEach((e=>r.addEventListener(...e)))};c();const i={close:(...e)=>(a=0,r.close(...e)),addEventListener:(...e)=>(s.push(e),r.addEventListener(...e)),removeEventListener:(...e)=>(s=s.filter((t=>e[0]!==t[0]||e[1]!==t[1])),r.removeEventListener(...e)),send:e=>(i.send.before?.(),r.send(e))};for(const e in r)null==i[e]&&Object.defineProperty(i,e,{enumerable:!0,get:()=>"function"==typeof r[e]?r[e].bind(r):r[e]});return i},createReconnectingWS=(e,t,n)=>{const r=makeReconnectingWS(e,t,n);return onCleanup((()=>r.close())),r},makeHeartbeatWS=(e,t={})=>{let n,r;const a=()=>(clearTimeout(n),clearTimeout(r));e.send.before=()=>{a(),r=setTimeout(e.reconnect,t.wait||1500)};const o=()=>{a(),n=setTimeout((()=>e.send(t.message||"ping")),t.interval||1e3)};return e.addEventListener("close",a),e.addEventListener("message",o),e.addEventListener("open",(()=>setTimeout(o,t.interval||1e3))),e},m=createSignal(makeHeartbeatWS(createReconnectingWS(p.Data[0]().Socket,void 0,{delay:0,retries:5}),{interval:5e4,message:"beat"}));const Socket=Object.freeze(Object.defineProperty({__proto__:null,default:m},Symbol.toStringTag,{value:"Module"}));export{Socket as S,createWSState as c,m};